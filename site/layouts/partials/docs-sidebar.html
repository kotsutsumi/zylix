{{/* Docs Sidebar Navigation */}}
{{ $currentPage := . }}
{{ $docsSection := site.GetPage "/docs" }}

<nav class="docs-sidebar w-64 shrink-0 hidden lg:block">
  <div class="sticky top-32 overflow-y-auto max-h-[calc(100vh-10rem)] pb-10">
    <ul class="space-y-3 text-sm">
      {{/* Main docs link */}}
      <li>
        <a href="{{ $docsSection.RelPermalink }}"
           class="block py-2 px-3 rounded-md font-medium transition-colors
                  {{ if eq $currentPage.RelPermalink $docsSection.RelPermalink }}
                    bg-primary-100 text-primary-700 dark:bg-primary-900/30 dark:text-primary-400
                  {{ else }}
                    text-neutral-700 hover:bg-neutral-100 dark:text-neutral-300 dark:hover:bg-neutral-800
                  {{ end }}">
          {{ $docsSection.Title }}
        </a>
      </li>

      {{/* Top-level pages (not in subsections, excluding section index pages) */}}
      {{ $topPages := where $docsSection.Pages "Section" "docs" }}
      {{ range $topPages.ByWeight }}
        {{ if not .IsSection }}
        {{ if not .Params.hidden }}
        <li>
          <a href="{{ .RelPermalink }}"
             class="block py-2 px-3 rounded-md transition-colors
                    {{ if eq $currentPage.RelPermalink .RelPermalink }}
                      bg-primary-100 text-primary-700 dark:bg-primary-900/30 dark:text-primary-400 font-medium
                    {{ else }}
                      text-neutral-600 hover:bg-neutral-100 dark:text-neutral-400 dark:hover:bg-neutral-800
                    {{ end }}">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
        {{ end }}
      {{ end }}

      {{/* Subsections */}}
      {{ range $docsSection.Sections.ByWeight }}
        {{ $section := . }}
        {{ $isInSection := or (eq $currentPage.Section .Section) (hasPrefix $currentPage.RelPermalink .RelPermalink) }}
        <li class="pt-5">
          <a href="{{ .RelPermalink }}"
             class="block py-2 px-3 rounded-md font-medium transition-colors
                    {{ if eq $currentPage.RelPermalink .RelPermalink }}
                      bg-primary-100 text-primary-700 dark:bg-primary-900/30 dark:text-primary-400
                    {{ else }}
                      text-neutral-700 hover:bg-neutral-100 dark:text-neutral-300 dark:hover:bg-neutral-800
                    {{ end }}">
            {{ .Title }}
          </a>
          {{/* Section children */}}
          {{ if gt (len .Pages) 0 }}
          <ul class="mt-2 ml-3 space-y-2 border-l border-neutral-200 dark:border-neutral-700">
            {{ range .Pages.ByWeight }}
              {{ if not .Params.hidden }}
              <li>
                <a href="{{ .RelPermalink }}"
                   class="block py-1.5 px-3 rounded-r-md transition-colors
                          {{ if eq $currentPage.RelPermalink .RelPermalink }}
                            border-l-2 border-primary-500 -ml-px bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-400 font-medium
                          {{ else }}
                            text-neutral-600 hover:bg-neutral-100 dark:text-neutral-400 dark:hover:bg-neutral-800
                          {{ end }}">
                  {{ .Title }}
                </a>
              </li>
              {{ end }}
            {{ end }}
          </ul>
          {{ end }}
        </li>
      {{ end }}
    </ul>
  </div>
</nav>
