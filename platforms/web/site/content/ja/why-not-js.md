---
title: "なぜJavaScriptではないのか？"
weight: 2
---

# なぜJavaScriptではないのか？

## Webプラットフォームの問題

JavaScriptはWebを動かしていますが、**インタラクション**ではなく**計算**が必要な場合、その限界が明らかになります。

## 比較

| 側面 | JavaScript | WebWorker | Zig (WASM) |
|------|-----------|-----------|------------|
| 並列性 | 協調的 | 分離プロセス | 共有メモリ |
| メモリ | GC管理 | GC管理 | 手動、予測可能 |
| GCポーズ | あり | あり | **なし** |
| GPUデータ | TypedArray (GC) | TypedArray | **直接レイアウト** |
| 型安全性 | ランタイム | ランタイム | **コンパイル時** |

## パフォーマンスの現実

### JavaScript
```javascript
// GCはいつでも一時停止する可能性がある
const vertices = new Float32Array(10000);
// TypedArrayもGCに管理される
// メモリレイアウトの保証なし
```

### Zig (WASM)
```zig
// GPU用16バイトアライメント
pub const Vertex = extern struct {
    position: Vec3,  // 16バイト
    color: Vec4,     // 16バイト
};
// 直接メモリレイアウトがGPUと一致
// GCなし、予測可能なタイミング
```

## 実際の影響

### フレームレートの一貫性

**JavaScript**:
- 目標: 60fps (1フレーム16.67ms)
- GCポーズ: 5-50ms
- 結果: カクつき、フレーム落ち

**Zig/WASM**:
- 目標: 60fps (1フレーム16.67ms)
- GCなし: 一貫したタイミング
- 結果: スムーズなアニメーション

### メモリ効率

**JavaScriptアプリ**（典型的）:
- 初期ヒープ: 10-50MB
- 実行後: 100-500MB
- メモリフラグメンテーション: 高

**Zig/WASMアプリ**:
- リニアメモリ: 1-10MB
- 実行後: 同じ
- メモリフラグメンテーション: なし（手動制御）

## JavaScriptが適している場合

JavaScriptが得意なこと:
- DOM操作
- イベント処理
- API呼び出し
- UI調整

## Zigが輝く場面

Zigが得意なこと:
- 重い計算
- リアルタイムグラフィックス
- データ処理
- 予測可能なパフォーマンス

## ZigDomの思想

> **「JavaScriptはI/O、Zigは実行」**

ZigDomはJavaScriptを置き換えません - 各言語を最も強い場所に配置します：

```
┌─────────────────────────────────────────────────────┐
│                  Zigコア (WASM)                     │
│  - 状態管理            - GPUデータ生成              │
│  - ビジネスロジック    - レイアウト計算             │
│  - 数学演算            - コンポーネントツリー       │
└─────────────────────────┬───────────────────────────┘
                          │ export fn (ポインタ + サイズ)
                          ▼
┌─────────────────────────────────────────────────────┐
│            JavaScriptブリッジレイヤー                │
│  - DOM操作             - WebGPU API呼び出し         │
│  - イベントバインド    - レンダー実行               │
│  - ユーザー入力        - アニメーションフレーム     │
└─────────────────────────────────────────────────────┘
```

## ベンチマーク：パーティクルシステム

| 指標 | JavaScript | Zig/WASM |
|------|-----------|----------|
| 5万パーティクル | 約30fps | **60fps** |
| メモリ使用量 | 150MB | **8MB** |
| GCポーズ | 5-20ms | **0ms** |
| フレーム変動 | ±8ms | **±0.5ms** |

## 結論

JavaScriptが悪いわけではありません - 計算重視のタスク向けに設計されていないだけです。JavaScriptの強み（I/O、DOM）とZigの強み（計算、メモリ制御）を組み合わせることで、両方の良いところを得られます。
